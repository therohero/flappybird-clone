<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #70c5ce; }
        #game-canvas { display: block; width: 100vw; height: 100vh; }
        #start-screen, #game-over {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; background: rgba(0,0,0,0.5); color: white;
        }
        #game-over { display: none; }
        button { 
            padding: 15px 30px; 
            margin-top: 20px; 
            background: #f8d347; 
            border: none; 
            font-size: 1.2rem;
            border-radius: 5px;
        }
        h1 { font-size: 2.5rem; margin-bottom: 20px; }
        #score-text { font-size: 1.5rem; margin-bottom: 10px; }
        #home-btn {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 10001;
            background: #fffbe7;
            color: #333;
            border: 2px solid #f8d347;
            border-radius: 50px;
            padding: 10px 22px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: none;
        }
        #pause-btn {
            position: fixed;
            top: 24px;
            right: 80px;
            z-index: 10001;
            display: none;
            background: #fffbe7;
            color: #333;
            border: 2px solid #f8d347;
            border-radius: 50px;
            padding: 10px 22px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        #help-overlay, #credits-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        #help-content, #credits-content {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        #help-content h2, #credits-content h2 {
            margin-bottom: 15px;
        }
        #help-content ul, #credits-content ul {
            list-style: none;
            padding: 0;
            margin: 0 0 15px 0;
            text-align: left;
        }
        #help-content li, #credits-content li {
            margin-bottom: 10px;
        }
        #credits-overlay {
            display: none;
            position: fixed;
            z-index: 20001;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
        }
        #credits-content {
            background: #fffbe7;
            color: #333;
            padding: 32px 24px;
            border-radius: 16px;
            max-width: 90vw;
            box-shadow: 0 4px 24px rgba(0,0,0,0.2);
            text-align: left;
        }
        #close-credits {
            margin-top: 20px;
            background: #f8d347;
            border: none;
            border-radius: 5px;
            padding: 10px 24px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
        }
        #pause-overlay {
            display:none;
            position:fixed;
            top:0;
            left:0;
            width:100vw;
            height:100vh;
            background:rgba(0,0,0,0.5);
            z-index:20000;
            justify-content:center;
            align-items:center;
            color:white;
            font-size:2.5rem;
            font-weight:bold;
        }
    </style>
</head>
<body>
    <canvas id="game-canvas"></canvas>
    <div id="start-screen">
        <h2 style="margin: 0; scale: 0.5;">Therohero Studios Presents</h2>
        <h1>Flappy Bird</h1>
        <div id="highscore-text" style="font-size:1.2rem;margin-bottom:10px;"></div>
        <button id="start-button">Spiel starten</button>
        <button id="help-btn">Spielerklärung</button>
        <button id="reset-highscore-btn" style="margin-bottom:10px;">Highscore zurücksetzen</button>
        <button id="credits-btn" style="position:fixed;bottom:18px;left:18px;z-index:10002;">Mitwirkende & Rechte</button>
    </div>
    <div id="help-overlay">
        <div id="help-content">
            <h2>Wie spielt man?</h2>
            <ul>
                <li>Tippe oder drücke die Leertaste, damit der Vogel fliegt.</li>
                <li>Weiche den Röhren aus.</li>
                <li>Für jede überflogene Röhre gibt es einen Punkt.</li>
                <li>Das Spiel endet, wenn du eine Röhre berührst oder den Boden/Decke.</li>
            </ul>
            <button id="close-help">Schließen</button>
        </div>
    </div>
    <div id="game-over">
        <h1>Game Over</h1>
        <p id="score-text">Punkte: 0</p>
        <p id="highscore-gameover" style="font-size:1.2rem;margin-bottom:10px;"></p>
        <button id="restart-button">Nochmal spielen</button>
    </div>
    <button id="home-btn">Home</button>
    <button id="pause-btn" style="position:fixed;top:24px;right:80px;z-index:10001;display:none;">⏸️</button>
    <div id="credits-overlay">
        <div id="credits-content">
            <h2>Mitwirkende & Rechte</h2>
            <ul style="margin-bottom:16px;">
                <li>Idee & Code: Therohero Studios</li>
                <li>Originalkonzept: Dong Nguyen</li>
                <li>Grafik & Sounds: Eigene Umsetzung / frei verwendbare Ressourcen</li>
                <a href="https://github.com/therohero/flappybird-clone" target="_blank" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'" text-decoration="none">Repository </a><a href="https://github.com/therohero" target="_blank" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'" textDecoration="none">Account</a>
            </ul>
            <p style="font-size:0.95em;color:#555;">Dieses Projekt ist ein Fan-Remake zu Lernzwecken und nicht kommerziell.</p>
            <button id="close-credits">Schließen</button>
        </div>
    </div>

    <script>
    (function() {
        'use strict';
        
        // KONSTANTE WERTE - angepasst für Mobile
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const PIPE_GAP = isMobile ? 150 : 200;
        const PIPE_WIDTH = isMobile ? 40 : 60;
        const PIPE_SPEED = isMobile ? 1 : 3;
        const BIRD_SIZE = isMobile ? 25 : 40;
        let runner = 0;

        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        let gameRunning = false, score = 0, animationId = null;
        let highscore = Number(localStorage.getItem('flappy_highscore')) || 0;
        let isJumping = false;
        let paused = false;

        function updateHighscoreDisplay() {
            document.getElementById('highscore-text').textContent = `Highscore: ${highscore}`;
            document.getElementById('highscore-gameover').textContent = `Highscore: ${highscore}`;
        }
        
        // Vogel - kleiner auf Mobile
        const birdImg = new Image();
        birdImg.src = 'assets/bird.png';
        const birdJumpImg = new Image();
        birdJumpImg.src = 'assets/jumpbird.png';

        // Speichere die tatsächliche Bildgröße für die Hitbox
        let birdTextureWidth = 18;  // Standardwert, falls Bild noch nicht geladen
        let birdTextureHeight = 12;

        birdImg.onload = function() {
            birdTextureWidth = birdImg.naturalWidth;
            birdTextureHeight = birdImg.naturalHeight;
        };
        birdJumpImg.onload = function() {
            // Optional: falls jumpbird.png andere Maße hat
            birdTextureWidth = birdJumpImg.naturalWidth;
            birdTextureHeight = birdJumpImg.naturalHeight;
        };

        const bird = {
            x: window.innerHeight / 4,
            y: 300,
            width: BIRD_SIZE,
            height: BIRD_SIZE,
            velocity: 0,
            gravity: isMobile ? 0.1 : 0.5,
            jump: isMobile ? -3 : -10,
            update: function() {
                this.velocity += this.gravity;
                this.y += this.velocity;
            },
            draw: function() {
                const img = isJumping ? birdJumpImg : birdImg;
                if (img.complete && img.naturalWidth > 0) {
                    // Immer quadratisch rendern
                    ctx.drawImage(img, this.x, this.y, this.width, this.height);
                } else {
                    ctx.fillStyle = '#ffeb3b';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
            },
            // Liefert die aktuelle Hitbox (zentriert im Quadrat)
            getHitbox: function() {
                // Skaliere die Textur-Maße auf das Quadrat
                const scale = this.width / Math.max(birdTextureWidth, birdTextureHeight);
                const hitboxW = birdTextureWidth * scale;
                const hitboxH = birdTextureHeight * scale;
                return {
                    x: this.x + (this.width - hitboxW) / 2,
                    y: this.y + (this.height - hitboxH) / 2,
                    width: hitboxW,
                    height: hitboxH
                };
            }
        };
        
        // Röhren
        const pipes = [];
        function addPipe() {
            const height = Math.random() * (canvas.height - PIPE_GAP - 200) + 100;
            pipes.push({ x: canvas.width, height: height, passed: false });
        }
        
        // Initialisierung
        function init() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            document.getElementById('start-button').onclick = startGame;
            document.getElementById('restart-button').onclick = startGame;
            document.addEventListener('keydown', e => {
                if (e.code === 'Space') handleInput();
            });
            canvas.addEventListener('touchstart', handleInput);
            canvas.onclick = handleInput;
        }
        
        function handleInput() {
            if (!gameRunning) startGame();
            else {
                bird.velocity = bird.jump;
                isJumping = true;
                setTimeout(() => { isJumping = false; }, 200);
            }
        }
        
        const homeBtn = document.getElementById('home-btn');

        // Home-Button immer anzeigen, außer im Startscreen
        function updateHomeBtn() {
            if (
                document.getElementById('start-screen').style.display === 'none'
            ) {
                homeBtn.style.display = 'block';
            } else {
                homeBtn.style.display = 'none';
            }
        }

        // Home-Button bringt dich immer zum Startscreen zurück
        homeBtn.onclick = function() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            document.getElementById('start-screen').style.display = 'flex';
            document.getElementById('game-over').style.display = 'none';
            updateHomeBtn();
        };

        // Pause-Button
        const pauseBtn = document.getElementById('pause-btn');

        // Pause-Overlay (optional, für Anzeige)
        let pauseOverlay = document.getElementById('pause-overlay');
        if (!pauseOverlay) {
            pauseOverlay = document.createElement('div');
            pauseOverlay.id = 'pause-overlay';
            pauseOverlay.style = `
                display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;
                background:rgba(0,0,0,0.5);z-index:20000;justify-content:center;align-items:center;
                color:white;font-size:2.5rem;font-weight:bold;
            `;
            pauseOverlay.innerText = 'Pause';
            document.body.appendChild(pauseOverlay);
        }

        // Pause-Funktion
        function togglePause() {
            if (!gameRunning) return;
            paused = !paused;
            if (paused) {
                pauseOverlay.style.display = 'flex';
            } else {
                pauseOverlay.style.display = 'none';
                gameLoop();
            }
        }

        // Taste P für Pause
        document.addEventListener('keydown', e => {
            if (e.code === 'KeyP') togglePause();
        });

        // Button für Pause
        pauseBtn.onclick = togglePause;

        // Pause-Button nur anzeigen, wenn Spiel läuft (und nicht im Startscreen)
        function updatePauseBtn() {
            if (document.getElementById('start-screen').style.display === 'none' && gameRunning) {
                pauseBtn.style.display = 'block';
            } else {
                pauseBtn.style.display = 'none';
            }
        }

        // Passe gameLoop an:
        function gameLoop() {
            if (paused) return; // Bei Pause nicht weiterlaufen!
            // Update
            bird.update();
            
            // Neue Röhre (langsamer auf Mobile)
            runner++;
            if (runner % (isMobile ? 200 : 100) === 0) addPipe();
            
            // Röhren bewegen
            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= PIPE_SPEED;
                
                // Punkte
                if (!pipes[i].passed && pipes[i].x + PIPE_WIDTH < bird.x) {
                    pipes[i].passed = true;
                    score++;
                }
                
                // Entfernen
                if (pipes[i].x + PIPE_WIDTH < 0) pipes.splice(i, 1);
            }
            
            // Kollision
            const birdBox = bird.getHitbox();
            if (birdBox.y < 0 || birdBox.y + birdBox.height > canvas.height) {
                endGame();
                return;
            }

            for (const pipe of pipes) {
                // Oben
                if (
                    birdBox.x + birdBox.width > pipe.x &&
                    birdBox.x < pipe.x + PIPE_WIDTH &&
                    birdBox.y < pipe.height
                ) {
                    endGame();
                    return;
                }
                // Unten
                if (
                    birdBox.x + birdBox.width > pipe.x &&
                    birdBox.x < pipe.x + PIPE_WIDTH &&
                    birdBox.y + birdBox.height > pipe.height + PIPE_GAP
                ) {
                    endGame();
                    return;
                }
            }
            
            // Zeichnen
            ctx.fillStyle = '#70c5ce';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            bird.draw();
            
            // Pipe als gestapelte Streifen zeichnen
            for (const pipe of pipes) {
                // Obere Pipe (wie gehabt)
                let y = 0;
                while (y + 20 < pipe.height) {
                    ctx.drawImage(pipeBodyImg, pipe.x, y, PIPE_WIDTH, 20);
                    y += 20;
                }
                if (y < pipe.height) {
                    ctx.drawImage(pipeBodyImg, pipe.x, y, PIPE_WIDTH, pipe.height - y);
                }

                // Untere Pipe (von unten nach oben stapeln)
                let bottomPipeTop = pipe.height + PIPE_GAP;
                let y2 = canvas.height;
                while (y2 - 20 > bottomPipeTop) {
                    y2 -= 20;
                    ctx.drawImage(pipeBodyImg, pipe.x, y2, PIPE_WIDTH, 20);
                }
                if (y2 > bottomPipeTop) {
                    ctx.drawImage(pipeBodyImg, pipe.x, bottomPipeTop, PIPE_WIDTH, y2 - bottomPipeTop);
                }
            }
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold ' + (isMobile ? '24px' : '36px') + ' Arial';
            ctx.fillText(score, 30, isMobile ? 40 : 50);
            
            updatePauseBtn();
            animationId = requestAnimationFrame(gameLoop);
        }
        
        init();
        updateHomeBtn();
        updateHighscoreDisplay();

        // Hilfe-Overlay
        const helpBtn = document.getElementById('help-btn');
        const helpOverlay = document.getElementById('help-overlay');
        const closeHelp = document.getElementById('close-help');

        helpBtn.onclick = function() {
            helpOverlay.style.display = 'flex';
        };
        closeHelp.onclick = function() {
            helpOverlay.style.display = 'none';
        };
        helpOverlay.onclick = function(e) {
            if (e.target === helpOverlay) helpOverlay.style.display = 'none';
        };

        // Credits-Overlay
        const creditsBtn = document.getElementById('credits-btn');
        const creditsOverlay = document.getElementById('credits-overlay');
        const closeCredits = document.getElementById('close-credits');

        creditsBtn.onclick = function() {
            creditsOverlay.style.display = 'flex';
        };
        closeCredits.onclick = function() {
            creditsOverlay.style.display = 'none';
        };
        creditsOverlay.onclick = function(e) {
            if (e.target === creditsOverlay) creditsOverlay.style.display = 'none';
        };

        const pipeBodyImg = new Image();
        pipeBodyImg.src = 'assets/pipes/pipebody.png';

        // Sound laden

        function startGame() {
            gameRunning = true;
            paused = false;
            score = 0;
            runner = 0;
            bird.y = 300;
            bird.velocity = 0;
            pipes.length = 0;
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-over').style.display = 'none';
            updateHomeBtn();
            updatePauseBtn();
            animationId = requestAnimationFrame(gameLoop);
        }

        function endGame() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            document.getElementById('score-text').textContent = `Punkte: ${score}`;
            if (score > highscore) {
                highscore = score;
                localStorage.setItem('flappy_highscore', highscore);
            }
            updateHighscoreDisplay();
            document.getElementById('game-over').style.display = 'flex';
            updateHomeBtn();
            updatePauseBtn();
        }

        const resetHighscoreBtn = document.getElementById('reset-highscore-btn');
        resetHighscoreBtn.onclick = function() {
            highscore = 0;
            localStorage.setItem('flappy_highscore', '0');
            updateHighscoreDisplay();
            alert('Highscore wurde zurückgesetzt!');
        };
    })();
    </script>
</body>
</html>
